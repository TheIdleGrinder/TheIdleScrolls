@using TheIdleScrolls_Web.CoreWrapper

@inject CoreWrapperModel CoreWrapper

<div class="charOuter">
    <h2>@CoreWrapper.Character.Name</h2>

    <p style="margin-bottom: 0.5rem">Level @CoreWrapper.Character.Level @CoreWrapper.Character.Class</p>

    <progress title="@CoreWrapper.XpCurrent.ToBigIntString() / @CoreWrapper.XpTarget.ToBigIntString() XP" 
            value="@CoreWrapper.XpCurrent" max="@CoreWrapper.XpTarget">
    </progress>

    <hr class="thick">

    <table>
        <tr class="normal-font">
            <th>Damage</th>
            <td>@FormatValue(Stats.Damage)</td>
            <th>Defense Rating</th>
            <td>@FormatValue(Stats.DefenseRating)</td>
        </tr>
        <tr class="small-font">
            <th>Attack Time</th>
            <td>@FormatValue(Stats.Cooldown) s</td>
            <th>Armor</th>
            <td>@FormatValue(Stats.Armor)</td>
        </tr>
        <tr class="small-font">
            <th title="Damage per second">DPS</th>
            <td>@(FormatValue(Stats.Damage / Stats.Cooldown))</td>
            <th>Evasion</th>
            <td>@(FormatValue(Stats.Evasion)) %</td>
        </tr>
        <tr>
            <td colspan="2"><progress value="@AttackProgress" max="@AttackCooldown"></progress></td>
        </tr>
    </table>
</div>


@code {
    CharacterStats Stats => CoreWrapper.CharacterStats;

    protected override void OnInitialized()
    {
        CoreWrapper.StateChanged += StateHasChanged;
        base.OnInitialized();
    }

    int AttackCooldown => CooldownToInt(Stats.Cooldown);
    int AttackProgress => CooldownToInt(Stats.Cooldown) - CooldownToInt(Stats.CooldownRemaining);

    string FormatValue(double value) => value.ToBigIntString();
    int CooldownToInt(double time) => (int)(time * 1000);    
    string FormatTime(double time) => $"{time:0.##} s";
}